<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Rarify (subsample) biological sample to fixed count — rarify • BioMonTools</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Rarify (subsample) biological sample to fixed count — rarify"><meta property="og:description" content="Takes as an input a 3 column data frame (SampleID, TaxonID
, Count) and returns a similar dataframe with revised Counts.
The other inputs are subsample size (target number of organisms in each
sample) and seed. The seed is given so the results can be reproduced from the
 same input file.  If no seed is given a random seed is used."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BioMonTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2.9014</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/vignette_BioMonTools.html">Vignette, BioMonTools</a>
    </li>
    <li>
      <a href="../articles/vignette_MapTaxaObs.html">Taxa Maps</a>
    </li>
    <li>
      <a href="../articles/vignette_NewIndex.html">Vignette, Adding a New Index</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/leppott/BioMonTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Rarify (subsample) biological sample to fixed count</h1>
    <small class="dont-index">Source: <a href="https://github.com/leppott/BioMonTools/blob/HEAD/R/rarify.R" class="external-link"><code>R/rarify.R</code></a></small>
    <div class="hidden name"><code>rarify.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Takes as an input a 3 column data frame (SampleID, TaxonID
, Count) and returns a similar dataframe with revised Counts.</p>
<p>The other inputs are subsample size (target number of organisms in each
sample) and seed. The seed is given so the results can be reproduced from the
 same input file.  If no seed is given a random seed is used.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rarify</span><span class="op">(</span><span class="va">inbug</span>, <span class="va">sample.ID</span>, <span class="va">abund</span>, <span class="va">subsiz</span>, mySeed <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>inbug</dt>
<dd><p>Input data frame.  Needs 3 columns (SampleID, taxonomicID
, Count).</p></dd>


<dt>sample.ID</dt>
<dd><p>Column name in inbug for sample identifier.</p></dd>


<dt>abund</dt>
<dd><p>Column name in inbug for organism count.</p></dd>


<dt>subsiz</dt>
<dd><p>Target subsample size for each sample.</p></dd>


<dt>mySeed</dt>
<dd><p>Seed for random number generator.  If provided the results with
the same inbug file will produce the same results. Defaut = NA (random seed
will be used.)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a data frame with the same three columns but the abund field
has been modified so the total count for each sample is no longer above the
target (subsiz).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>rarify function:
 R function to rarify (subsample) a macroinvertebrate sample down to a fixed
 count; by John Van Sickle, USEPA. email: VanSickle.John@epa.gov ;
 Version 1.0, 06/10/05;</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Subsample to 500 organisms (from over 500 organisms) for 12 samples.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load bio data</span></span></span>
<span class="r-in"><span><span class="va">df_biodata</span> <span class="op">&lt;-</span> <span class="va">data_bio2rarify</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df_biodata</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 350   3</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">df_biodata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># subsample</span></span></span>
<span class="r-in"><span><span class="va">mySize</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="va">Seed_OR</span> <span class="op">&lt;-</span> <span class="fl">18590214</span></span></span>
<span class="r-in"><span><span class="va">Seed_WA</span> <span class="op">&lt;-</span> <span class="fl">18891111</span></span></span>
<span class="r-in"><span><span class="va">Seed_US</span> <span class="op">&lt;-</span> <span class="fl">17760704</span></span></span>
<span class="r-in"><span><span class="va">bugs_mysize</span> <span class="op">&lt;-</span> <span class="fu">rarify</span><span class="op">(</span>inbug<span class="op">=</span><span class="va">df_biodata</span>, sample.ID<span class="op">=</span><span class="st">"SampleID"</span></span></span>
<span class="r-in"><span>                     ,abund<span class="op">=</span><span class="st">"N_Taxa"</span>,subsiz<span class="op">=</span><span class="va">mySize</span>, mySeed<span class="op">=</span><span class="va">Seed_US</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Rarify of samples complete. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of samples =  12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Execution time (sec) =  0.00800000000000267 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># view results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bugs_mysize</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 350   3</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">bugs_mysize</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare pre- and post- subsample counts</span></span></span>
<span class="r-in"><span><span class="va">df_compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">df_biodata</span>, <span class="va">bugs_mysize</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SampleID"</span>, <span class="st">"TaxaID"</span><span class="op">)</span></span></span>
<span class="r-in"><span>                    , suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_Orig"</span>,<span class="st">"_500"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df_compare</span> <span class="op">&lt;-</span> <span class="va">df_compare</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SampleID"</span></span></span>
<span class="r-in"><span>                             , <span class="st">"TaxaID"</span></span></span>
<span class="r-in"><span>                             , <span class="st">"N_Taxa_Orig"</span></span></span>
<span class="r-in"><span>                             , <span class="st">"N_Taxa_500"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare totals</span></span></span>
<span class="r-in"><span><span class="va">tbl_totals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">N_Taxa_Orig</span>, <span class="va">N_Taxa_500</span><span class="op">)</span> <span class="op">~</span> <span class="va">SampleID</span></span></span>
<span class="r-in"><span>                                                     , <span class="va">df_compare</span>, <span class="va">sum</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">tbl_totals</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># save the data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">bugs_mysize</span></span></span>
<span class="r-in"><span>            , <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"bugs"</span>, <span class="va">mySize</span>, <span class="st">"txt"</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>                                         , sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Open tempdir (Windows only)</span></span></span>
<span class="r-in"><span><span class="fu">shell.exec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Erik W. Leppo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

