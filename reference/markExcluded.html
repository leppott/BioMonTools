<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mark "excluded" (non-distinct / non-unique / ambiguous) taxa — markExcluded • BioMonTools</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Mark " excluded non-unique ambiguous taxa markexcluded><meta property="og:description" content='Takes as an input data frame with Sample ID, Taxa ID, and
phlogenetic name fields and returns a similar dataframe with a column for
"excluded" taxa (TRUE or FALSE).
Excluded taxa are refered to by multiple names; ambiguous, non-distinct, and
non-unique. The "excluded" name was chosen so as to be consistent with
"non-target" taxa. That is, taxa marked as "TRUE" are treated as
undesireables.  Excluded taxa are those that are present in a sample when
taxa of the same group are present in the same sample are identified finer
level.  That is, the parent is marked as excluded when child taxa are
present in the same sample.'><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BioMonTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0.9109</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/vignette_BioMonTools.html">Vignette, BioMonTools</a>
    </li>
    <li>
      <a href="../articles/vignette_MapTaxaObs.html">Taxa Maps</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/leppott/BioMonTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Mark "excluded" (non-distinct / non-unique / ambiguous) taxa</h1>
    <small class="dont-index">Source: <a href="https://github.com/leppott/BioMonTools/blob/HEAD/R/markExcluded.R" class="external-link"><code>R/markExcluded.R</code></a></small>
    <div class="hidden name"><code>markExcluded.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Takes as an input data frame with Sample ID, Taxa ID, and
phlogenetic name fields and returns a similar dataframe with a column for
"excluded" taxa (TRUE or FALSE).</p>
<p>Excluded taxa are refered to by multiple names; ambiguous, non-distinct, and
non-unique. The "excluded" name was chosen so as to be consistent with
"non-target" taxa. That is, taxa marked as "TRUE" are treated as
undesireables.  Excluded taxa are those that are present in a sample when
taxa of the same group are present in the same sample are identified finer
level.  That is, the parent is marked as excluded when child taxa are
present in the same sample.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">markExcluded</span><span class="op">(</span>
  <span class="va">df_samptax</span>,
  SampID <span class="op">=</span> <span class="st">"SAMPLEID"</span>,
  TaxaID <span class="op">=</span> <span class="st">"TAXAID"</span>,
  TaxaCount <span class="op">=</span> <span class="st">"N_TAXA"</span>,
  Exclude <span class="op">=</span> <span class="st">"EXCLUDED"</span>,
  <span class="va">TaxaLevels</span>,
  <span class="va">Exceptions</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df_samptax</dt>
<dd><p>Input data frame.</p></dd>
<dt>SampID</dt>
<dd><p>Column name in df_samptax for sample identifier.
Default = "SAMPLEID".</p></dd>
<dt>TaxaID</dt>
<dd><p>Column name in df_samptax for organism identifier.
Default = "TAXAID".</p></dd>
<dt>TaxaCount</dt>
<dd><p>Column name in df_samptax for organism count.
Default = "N_TAXA".</p></dd>
<dt>Exclude</dt>
<dd><p>Column name for Excluded Taxa results in returned data frame.
Default = "Excluded".</p></dd>
<dt>TaxaLevels</dt>
<dd><p>Column names in df_samptax that for phylogenetic names to
be evaluated.
Need to be in order from coarse to fine (i.e., Phylum to Species).</p></dd>
<dt>Exceptions</dt>
<dd><p>NA or two column data frame of synonyms or other
exceptions.
Column 1 is the name used in the TaxaID column of df_samptax.
Column 2 is the name used in the TaxaLevels columns of df_samptax.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Returns a data frame of df_samptax with an additional column,
ExcludedTaxa.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The excluded taxa are referenced in the metric values function.
These taxa are removed from the taxa richness metrics.  This is because these
are coarser level taxa.</p>
<p>Exceptions is a 2 column data frame of synonyms or other exceptions.
Column 1 is the name used in the TaxaID column the input data frame
(df_samptax). Column 2 is the name used in the TaxaLevels columns of the
input data frame (df_samptax).  The phylogenetic columns (TaxaLevels) will be
modified from Column 2 of the Exceptions data frame to match Column 1 of the
Exceptions data frame.  This ensures that the algorithm for markExcluded
works properly. The changes will not be stored and the original names
provided in the input data frame (df_samptax) will be returned in the final
result.  The function example below includes a practical case.</p>
<p>Taxa Levels are phylogenetic names that are to be checked.  They should be
listed in order from course (kingdom) to fine (species).  Names not appearing
in the data will be skipped.</p>
<p>The spelling of names must be consistent (including case) for this function
to produce the intended output.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co"># Packages</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lazyeval</span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Data</span></span>
<span class="r-in"><span class="va">df_samps_bugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"./extdata/Data_Benthos.xlsx"</span></span>
<span class="r-in">                                        , package<span class="op">=</span><span class="st">"BioMonTools"</span><span class="op">)</span></span>
<span class="r-in">                           , guess_max<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Variables</span></span>
<span class="r-in"><span class="va">SampID</span>     <span class="op">&lt;-</span> <span class="st">"SampleID"</span></span>
<span class="r-in"><span class="va">TaxaID</span>     <span class="op">&lt;-</span> <span class="st">"TaxaID"</span></span>
<span class="r-in"><span class="va">TaxaCount</span>  <span class="op">&lt;-</span> <span class="st">"N_Taxa"</span></span>
<span class="r-in"><span class="va">Exclude</span>    <span class="op">&lt;-</span> <span class="st">"Exclude_New"</span></span>
<span class="r-in"><span class="va">TaxaLevels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kingdom"</span></span>
<span class="r-in">                , <span class="st">"Phylum"</span></span>
<span class="r-in">                , <span class="st">"SubPhylum"</span></span>
<span class="r-in">                , <span class="st">"Class"</span></span>
<span class="r-in">                , <span class="st">"SubClass"</span></span>
<span class="r-in">                , <span class="st">"Order"</span></span>
<span class="r-in">                , <span class="st">"SubOrder"</span></span>
<span class="r-in">                , <span class="st">"SuperFamily"</span></span>
<span class="r-in">                , <span class="st">"Family"</span></span>
<span class="r-in">                , <span class="st">"SubFamily"</span></span>
<span class="r-in">                , <span class="st">"Tribe"</span></span>
<span class="r-in">                , <span class="st">"Genus"</span></span>
<span class="r-in">                , <span class="st">"SubGenus"</span></span>
<span class="r-in">                , <span class="st">"Species"</span></span>
<span class="r-in">                , <span class="st">"Variety"</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Taxa that should be treated as equivalent</span></span>
<span class="r-in"><span class="va">Exceptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"TaxaID"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sphaeriidae"</span><span class="op">)</span></span>
<span class="r-in">                                    , <span class="st">"PhyloID"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pisidiidae"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Filter Data</span></span>
<span class="r-in"><span class="co"># df_samptax &lt;- filter(df_samps_bugs, !!as.name(SampID) ==</span></span>
<span class="r-in"><span class="co">#                                                  "08BEA3478__2013-08-21_0")</span></span>
<span class="r-in"><span class="co"># df_tst_small &lt;- markExcluded(df_samptax, SampID, TaxaID, TaxaCount</span></span>
<span class="r-in"><span class="co">#                              , TaxaLevels, Exceptions, Exclude)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># EXAMPLE 1</span></span>
<span class="r-in"><span class="va">df_tst</span> <span class="op">&lt;-</span> <span class="fu">markExcluded</span><span class="op">(</span><span class="va">df_samps_bugs</span></span>
<span class="r-in">                       , SampID<span class="op">=</span><span class="st">"SampleID"</span></span>
<span class="r-in">                       , TaxaID<span class="op">=</span><span class="st">"TaxaID"</span></span>
<span class="r-in">                       , TaxaCount <span class="op">=</span> <span class="st">"N_Taxa"</span></span>
<span class="r-in">                       , Exclude<span class="op">=</span><span class="st">"Exclude_New"</span></span>
<span class="r-in">                       , TaxaLevels<span class="op">=</span><span class="va">TaxaLevels</span></span>
<span class="r-in">                       , Exceptions<span class="op">=</span><span class="va">Exceptions</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *WARNING*, 3 taxa levels missing from input data frame; </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  KINGDOM, SUBORDER, VARIETY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (1/12); PHYLUM"</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`summarise_()` was deprecated in dplyr 0.7.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Please use `summarise()` instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`group_by_()` was deprecated in dplyr 0.7.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Please use `group_by()` instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> See vignette('programming') for more help</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (2/12); SUBPHYLUM"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (3/12); CLASS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (4/12); SUBCLASS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (5/12); ORDER"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (6/12); SUPERFAMILY"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (7/12); FAMILY"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (8/12); SUBFAMILY"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (9/12); TRIBE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (10/12); GENUS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (11/12); SUBGENUS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (12/12); SPECIES"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Compare</span></span>
<span class="r-in"><span class="va">df_compare</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">df_tst</span>, <span class="va">SampleID</span><span class="op">)</span></span>
<span class="r-in">                               , Exclude_Import<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Exclude</span><span class="op">)</span></span>
<span class="r-in">                               , Exclude_R<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Exclude_New</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">df_compare</span><span class="op">$</span><span class="va">Diff</span> <span class="op">&lt;-</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">Exclude_Import</span> <span class="op">-</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">Exclude_R</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="va">tbl_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">$</span><span class="va">Diff</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tbl_diff</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Var1 | Freq|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:----|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |0    |  678|</span>
<span class="r-in"><span class="co"># sort</span></span>
<span class="r-in"><span class="va">df_compare</span> <span class="op">&lt;-</span> <span class="va">df_compare</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Diff</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Number with issues</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">$</span><span class="va">Diff</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span class="co"># total samples</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 678</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># confusion matrix</span></span>
<span class="r-in"><span class="va">tbl_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df_tst</span><span class="op">$</span><span class="va">Exclude</span>, <span class="va">df_tst</span><span class="op">$</span><span class="va">Exclude_New</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="co"># Show differences</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tbl_results</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |      | FALSE| TRUE|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:-----|-----:|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |FALSE | 24653|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |TRUE  |     0| 2350|</span>
<span class="r-in"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |SampleID                   | Exclude_Import| Exclude_R| Diff|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:--------------------------|--------------:|---------:|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |01103CSR_Bug_2001-08-27_0  |              1|         1|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |02087REF_Bug_2002-08-22_0  |              0|         0|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |03013CSR_Bug_2003-07-01_0  |              1|         1|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |03053CSR_Bug_2003-08-14_0  |              6|         6|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |03054CSR_Bug_2003-08-18_0  |              2|         2|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |06012CSR_Bug_2006-09-05_0  |              1|         1|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |06019CSRw_Bug_2006-09-14_0 |              2|         2|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |06021CSR_Bug_2006-08-01_0  |              2|         2|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |06022CSR_Bug_2006-08-17_0  |              1|         1|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |06024CSR_Bug_2006-07-27_0  |              2|         2|    0|</span>
<span class="r-in"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">[</span><span class="fl">672</span><span class="op">:</span><span class="fl">678</span>, <span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |SampleID                | Exclude_Import| Exclude_R| Diff|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:-----------------------|--------------:|---------:|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |ricci__2013-09-04_0     |              7|         7|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |silvr192__2012-08-24_0  |              3|         3|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |skytrmann__2010-08-12_0 |              6|         6|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |skytrmann__2013-08-28_0 |              8|         8|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |swampcart__2012-08-20_0 |              6|         6|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |woodshand__2010-08-06_0 |             12|        12|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |woodshand__2013-09-03_0 |              4|         4|    0|</span>
<span class="r-in"><span class="co"># samples with differences</span></span>
<span class="r-in"><span class="va">samp_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">df_compare</span><span class="op">[</span><span class="va">df_compare</span><span class="op">[</span>,<span class="st">"Diff"</span><span class="op">]</span><span class="op">!=</span><span class="fl">0</span>, <span class="st">"SampleID"</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># results for only those with differences</span></span>
<span class="r-in"><span class="va">df_tst_diff</span> <span class="op">&lt;-</span> <span class="va">df_tst</span><span class="op">[</span><span class="va">df_tst</span><span class="op">[</span>,<span class="st">"SampleID"</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">samp_diff</span><span class="op">$</span><span class="va">SampleID</span>, <span class="op">]</span></span>
<span class="r-in"><span class="co"># add diff field</span></span>
<span class="r-in"><span class="va">df_tst_diff</span><span class="op">$</span><span class="va">Exclude_Diff</span> <span class="op">&lt;-</span> <span class="va">df_tst_diff</span><span class="op">$</span><span class="va">Exclude</span> <span class="op">-</span> <span class="va">df_tst_diff</span><span class="op">$</span><span class="va">Exclude_New</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Classification Performance Metrics</span></span>
<span class="r-in"><span class="va">class_TP</span> <span class="op">&lt;-</span> <span class="va">tbl_results</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># True Positive</span></span>
<span class="r-in"><span class="va">class_FN</span> <span class="op">&lt;-</span> <span class="va">tbl_results</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># False Negative</span></span>
<span class="r-in"><span class="va">class_FP</span> <span class="op">&lt;-</span> <span class="va">tbl_results</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># False Positive</span></span>
<span class="r-in"><span class="va">class_TN</span> <span class="op">&lt;-</span> <span class="va">tbl_results</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># True Negative</span></span>
<span class="r-in"><span class="va">class_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tbl_results</span><span class="op">)</span>  <span class="co"># total</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="co"># sensitivity (recall); TP / (TP+FN); measure model to ID true positives</span></span>
<span class="r-in"><span class="va">class_sens</span> <span class="op">&lt;-</span> <span class="va">class_TP</span> <span class="op">/</span> <span class="op">(</span><span class="va">class_TP</span> <span class="op">+</span> <span class="va">class_FN</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># precision; TP / (TP+FP); accuracy of model positives</span></span>
<span class="r-in"><span class="va">class_prec</span> <span class="op">&lt;-</span> <span class="va">class_TP</span> <span class="op">/</span> <span class="op">(</span><span class="va">class_TP</span> <span class="op">+</span> <span class="va">class_FP</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># specifity; TN / (TN + FP); measure model to ID true negatives</span></span>
<span class="r-in"><span class="va">class_spec</span> <span class="op">&lt;-</span> <span class="va">class_TN</span>  <span class="op">/</span> <span class="op">(</span><span class="va">class_TN</span> <span class="op">+</span> <span class="va">class_FP</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># overall accuracy; (TP + TN) / all cases; accuracy of all classifications</span></span>
<span class="r-in"><span class="va">class_acc</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">class_TP</span> <span class="op">+</span> <span class="va">class_TN</span><span class="op">)</span> <span class="op">/</span> <span class="va">class_n</span></span>
<span class="r-in"><span class="co"># F1; 2 * (class_prec*class_sens) / (class_prec+class_sens)</span></span>
<span class="r-in"><span class="co">## balance of precision and recall</span></span>
<span class="r-in"><span class="va">class_F1</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">class_prec</span> <span class="op">*</span> <span class="va">class_sens</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">class_prec</span> <span class="op">+</span> <span class="va">class_sens</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="va">results_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sensitivity (Recall)"</span></span>
<span class="r-in">                   , <span class="st">"Precision"</span></span>
<span class="r-in">                   , <span class="st">"Specificity"</span></span>
<span class="r-in">                   , <span class="st">"Overall Accuracy"</span></span>
<span class="r-in">                   , <span class="st">"F1"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">results_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">class_sens</span></span>
<span class="r-in">                   , <span class="va">class_prec</span></span>
<span class="r-in">                   , <span class="va">class_spec</span></span>
<span class="r-in">                   , <span class="va">class_acc</span></span>
<span class="r-in">                   , <span class="va">class_F1</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="va">tbl_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">results_names</span>, <span class="va">results_values</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tbl_class</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Performance Metrics"</span>, <span class="st">"Percent"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">tbl_class</span><span class="op">$</span><span class="va">Percent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tbl_class</span><span class="op">$</span><span class="va">Percent</span> <span class="op">*</span><span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tbl_class</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Performance Metrics  | Percent|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:--------------------|-------:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Sensitivity (Recall) |     100|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Precision            |     100|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Specificity          |     100|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Overall Accuracy     |     100|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |F1                   |     100|</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># EXAMPLE 2</span></span>
<span class="r-in"><span class="co">## No Exceptions</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">df_tst2</span> <span class="op">&lt;-</span> <span class="fu">markExcluded</span><span class="op">(</span><span class="va">df_samps_bugs</span></span>
<span class="r-in">                        , SampID<span class="op">=</span><span class="st">"SampleID"</span></span>
<span class="r-in">                        , TaxaID<span class="op">=</span><span class="st">"TaxaID"</span></span>
<span class="r-in">                        , TaxaCount <span class="op">=</span> <span class="st">"N_Taxa"</span></span>
<span class="r-in">                        , Exclude<span class="op">=</span><span class="st">"Exclude_New"</span></span>
<span class="r-in">                        , TaxaLevels<span class="op">=</span><span class="va">TaxaLevels</span></span>
<span class="r-in">                        , Exceptions<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *WARNING*, 3 taxa levels missing from input data frame; </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  KINGDOM, SUBORDER, VARIETY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (1/12); PHYLUM"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (2/12); SUBPHYLUM"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (3/12); CLASS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (4/12); SUBCLASS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (5/12); ORDER"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (6/12); SUPERFAMILY"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (7/12); FAMILY"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (8/12); SUBFAMILY"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (9/12); TRIBE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (10/12); GENUS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (11/12); SUBGENUS"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Working on item (12/12); SPECIES"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Compare</span></span>
<span class="r-in"><span class="va">df_compare2</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">df_tst2</span>, <span class="va">SampleID</span><span class="op">)</span></span>
<span class="r-in">                               , Exclude_Import<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Exclude</span><span class="op">)</span></span>
<span class="r-in">                               , Exclude_R<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Exclude_New</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">df_compare2</span><span class="op">$</span><span class="va">Diff</span> <span class="op">&lt;-</span> <span class="va">df_compare2</span><span class="op">$</span><span class="va">Exclude_Import</span> <span class="op">-</span> <span class="va">df_compare2</span><span class="op">$</span><span class="va">Exclude_R</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="va">tbl_diff2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df_compare2</span><span class="op">$</span><span class="va">Diff</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tbl_diff2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Var1 | Freq|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:----|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |0    |  670|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |1    |    8|</span>
<span class="r-in"><span class="co"># sort</span></span>
<span class="r-in"><span class="va">df_compare2</span> <span class="op">&lt;-</span> <span class="va">df_compare2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Diff</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Number with issues</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">df_compare2</span><span class="op">$</span><span class="va">Diff</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 8</span>
<span class="r-in"><span class="co"># total samples</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_compare2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 678</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># confusion matrix</span></span>
<span class="r-in"><span class="va">tbl_results2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df_tst2</span><span class="op">$</span><span class="va">Exclude</span>, <span class="va">df_tst2</span><span class="op">$</span><span class="va">Exclude_New</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="co"># Show differences</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tbl_results2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |      | FALSE| TRUE|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:-----|-----:|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |FALSE | 24653|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |TRUE  |     8| 2342|</span>
<span class="r-in"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_compare2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |SampleID                  | Exclude_Import| Exclude_R| Diff|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:-------------------------|--------------:|---------:|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |08BEA3478__2013-08-21_0   |              3|         2|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |08BEA3571__2014-09-03_0   |              5|         4|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |08LIT2692__2012-09-10_0   |              8|         7|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |08SAM0000__2012-07-11_0   |              4|         3|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |08SAM0000__2013-07-25_0   |              4|         3|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |09BLA0716__2014-08-14_0   |              3|         2|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |95C__2012-10-02_0         |              1|         0|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |95T__2012-10-03_0         |              1|         0|    1|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |01103CSR_Bug_2001-08-27_0 |              1|         1|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |02087REF_Bug_2002-08-22_0 |              0|         0|    0|</span>
<span class="r-in"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">df_compare2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |SampleID                | Exclude_Import| Exclude_R| Diff|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:-----------------------|--------------:|---------:|----:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |silvr192__2012-08-24_0  |              3|         3|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |skytrmann__2010-08-12_0 |              6|         6|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |skytrmann__2013-08-28_0 |              8|         8|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |swampcart__2012-08-20_0 |              6|         6|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |woodshand__2010-08-06_0 |             12|        12|    0|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |woodshand__2013-09-03_0 |              4|         4|    0|</span>
<span class="r-in"><span class="co"># samples with differences</span></span>
<span class="r-in"><span class="op">(</span><span class="va">samp_diff2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">df_compare2</span><span class="op">[</span><span class="va">df_compare2</span><span class="op">[</span>,<span class="st">"Diff"</span><span class="op">]</span><span class="op">!=</span><span class="fl">0</span></span>
<span class="r-in">                                                  , <span class="st">"SampleID"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  SampleID</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 08BEA3478__2013-08-21_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 08BEA3571__2014-09-03_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 08LIT2692__2012-09-10_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 08SAM0000__2012-07-11_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 08SAM0000__2013-07-25_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 09BLA0716__2014-08-14_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7       95C__2012-10-02_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       95T__2012-10-03_0</span>
<span class="r-in"><span class="co"># results for only those with differences</span></span>
<span class="r-in"><span class="va">df_tst_diff2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df_tst2</span>, <span class="va">SampleID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">samp_diff2</span><span class="op">$</span><span class="va">SampleID</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># add diff field</span></span>
<span class="r-in"><span class="va">df_tst_diff2</span><span class="op">$</span><span class="va">Exclude_Diff</span> <span class="op">&lt;-</span> <span class="va">df_tst_diff2</span><span class="op">$</span><span class="va">Exclude</span> <span class="op">-</span> <span class="va">df_tst_diff2</span><span class="op">$</span><span class="va">Exclude_New</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Classification Performance Metrics</span></span>
<span class="r-in"><span class="va">class_TP2</span> <span class="op">&lt;-</span> <span class="va">tbl_results2</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># True Positive</span></span>
<span class="r-in"><span class="va">class_FN2</span> <span class="op">&lt;-</span> <span class="va">tbl_results2</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># False Negative</span></span>
<span class="r-in"><span class="va">class_FP2</span> <span class="op">&lt;-</span> <span class="va">tbl_results2</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="co"># False Positive</span></span>
<span class="r-in"><span class="va">class_TN2</span> <span class="op">&lt;-</span> <span class="va">tbl_results2</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># True Negative</span></span>
<span class="r-in"><span class="va">class_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tbl_results2</span><span class="op">)</span>  <span class="co"># total</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="co"># sensitivity (recall); TP / (TP+FN); measure model to ID true positives</span></span>
<span class="r-in"><span class="va">class_sens2</span> <span class="op">&lt;-</span> <span class="va">class_TP2</span> <span class="op">/</span> <span class="op">(</span><span class="va">class_TP2</span> <span class="op">+</span> <span class="va">class_FN2</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># precision; TP / (TP+FP); accuracy of model positives</span></span>
<span class="r-in"><span class="va">class_prec2</span> <span class="op">&lt;-</span> <span class="va">class_TP2</span> <span class="op">/</span> <span class="op">(</span><span class="va">class_TP2</span> <span class="op">+</span> <span class="va">class_FP2</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># specifity; TN / (TN + FP); measure model to ID true negatives</span></span>
<span class="r-in"><span class="va">class_spec2</span> <span class="op">&lt;-</span> <span class="va">class_TN2</span> <span class="op">/</span> <span class="op">(</span><span class="va">class_TN2</span> <span class="op">+</span> <span class="va">class_FP2</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># overall accuracy; (TP + TN) / all cases; accuracy of all classifications</span></span>
<span class="r-in"><span class="va">class_acc2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">class_TP2</span> <span class="op">+</span> <span class="va">class_TN2</span><span class="op">)</span> <span class="op">/</span> <span class="va">class_n2</span></span>
<span class="r-in"><span class="co"># F1; 2 * (class_prec*class_sens) / (class_prec+class_sens)</span></span>
<span class="r-in"><span class="co">## balance of precision and recall</span></span>
<span class="r-in"><span class="va">class_F12</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">class_prec2</span> <span class="op">*</span> <span class="va">class_sens2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">class_prec2</span> <span class="op">+</span> <span class="va">class_sens2</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="va">results_names2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sensitivity (Recall)"</span></span>
<span class="r-in">                    , <span class="st">"Precision"</span></span>
<span class="r-in">                    , <span class="st">"Specificity"</span></span>
<span class="r-in">                    , <span class="st">"Overall Accuracy"</span></span>
<span class="r-in">                    , <span class="st">"F1"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">results_values2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">class_sens2</span></span>
<span class="r-in">                    , <span class="va">class_prec2</span></span>
<span class="r-in">                    , <span class="va">class_spec2</span></span>
<span class="r-in">                    , <span class="va">class_acc2</span></span>
<span class="r-in">                    , <span class="va">class_F12</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#</span></span>
<span class="r-in"><span class="va">tbl_class2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">results_names2</span>, <span class="va">results_values2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tbl_class2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Performance Metrics"</span>, <span class="st">"Percent"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">tbl_class2</span><span class="op">$</span><span class="va">Percent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tbl_class2</span><span class="op">$</span><span class="va">Percent</span> <span class="op">*</span><span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tbl_class2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Performance Metrics  | Percent|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |:--------------------|-------:|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Sensitivity (Recall) |   99.66|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Precision            |  100.00|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Specificity          |  100.00|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |Overall Accuracy     |   99.97|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |F1                   |   99.83|</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Erik W. Leppo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

